<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Guessing Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #movieImage {
            max-width: 300px;
            max-height: 300px;
            margin-bottom: 20px;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
        #timer, #score, #userGuess {
            font-size: 24px;
            margin: 10px 0;
        }
        #userGuess {
            font-style: italic;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>Guess the Movie</h1>
    <div id="timer">Time: 60</div>
    <div id="score">Score: 0</div>
    <img id="movieImage" src="/api/placeholder/300/300" alt="Movie Image">
    <div id="userGuess">Your guess will appear here</div>
    <p id="result"></p>
    <button id="startGame">Start Game</button>

    <script>
        const movies = [
            { name: "The Godfather", image: "./i1.png" },
            { name: "Pulp Fiction", image: "./i2.jpeg" },
            { name: "The Dark Knight", image: "./i3.jpeg" }
        ];
        let currentMovie;
        let score = 0;
        let timeLeft = 60;
        let timerInterval;
        let gameStarted = false;
        let recognition;

        const movieImage = document.getElementById('movieImage');
        const resultElement = document.getElementById('result');
        const startGameButton = document.getElementById('startGame');
        const timerElement = document.getElementById('timer');
        const scoreElement = document.getElementById('score');
        const userGuessElement = document.getElementById('userGuess');

        function loadNextMovie() {
            currentMovie = movies[Math.floor(Math.random() * movies.length)];
            movieImage.src = currentMovie.image;
            resultElement.textContent = '';
            userGuessElement.textContent = 'Your guess will appear here';
        }

        async function startGame() {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                gameStarted = true;
                score = 0;
                timeLeft = 60;
                updateScore();
                startGameButton.style.display = 'none';
                initializeSpeechRecognition();
                loadNextMovie();
                startTimer();
                recognition.start();
            } catch (err) {
                console.error('Error accessing microphone:', err);
                alert('Microphone access is required to play the game. Please allow microphone access and try again.');
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `Time: ${timeLeft}`;
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function updateScore() {
            scoreElement.textContent = `Score: ${score}`;
        }

        function endGame() {
            clearInterval(timerInterval);
            resultElement.textContent = `Game Over! Your final score is ${score}.`;
            startGameButton.style.display = 'inline';
            startGameButton.textContent = 'Play Again';
            gameStarted = false;
            recognition.stop();
        }

        function initializeSpeechRecognition() {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.continuous = true;
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const guess = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                console.log("Captured Speech: ", guess);
                userGuessElement.textContent = `Your guess: ${guess}`;
                if (guess === currentMovie.name.toLowerCase()) {
                    score++;
                    updateScore();
                    resultElement.textContent = 'Correct!';
                    setTimeout(loadNextMovie, 1000);
                } else {
                    resultElement.textContent = 'Incorrect. Try again!';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                resultElement.textContent = 'Error in speech recognition. Please try again.';
            };

            recognition.onend = () => {
                if (gameStarted) {
                    recognition.start();
                }
            };
        }

        startGameButton.addEventListener('click', startGame);
    </script>
</body>
</html>
