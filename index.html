<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Guessing Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #movieImage {
            max-width: 300px;
            max-height: 300px;
            margin-bottom: 20px;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
        #timer, #score, #userGuess {
            font-size: 24px;
            margin: 10px 0;
        }
        #userGuess {
            font-style: italic;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>Guess the Movie</h1>
    <div id="timer">Time: 60</div>
    <div id="score">Score: 0</div>
    <img id="movieImage" src="/api/placeholder/300/300" alt="Movie Image">
    <div id="userGuess">Your guess will appear here</div>
    <p id="result"></p>
    <button id="startGame">Start Game</button>

    <script>
        const movies = [
  { name: "C/o Kancharapalem", image: "./images/image 1.png" },
  { name: "Jersey", image: "./images/image 2.png" },
  { name: "Mayabazar", image: "./images/image 3.png" },
  { name: "Sita Ramam", image: "./images/image 4.png" },
  { name: "Nuvvu Naaku Nachchav", image: "./images/image 5.png" },
  { name: "Agent Sai Srinivasa Athreya", image: "./images/image 6.png" },
  { name: "Aha Naa Pellanta", image: "./images/image 7.png" },
  { name: "Mahanati", image: "./images/image 8.png" },
  { name: "Aa Naluguru", image: "./images/image 9.png" },
  { name: "Baahubali 2: The Conclusion", image: "./images/image 10.png" },
  { name: "Bommarillu", image: "./images/image 11.png" },
  { name: "Pelli Choopulu", image: "./images/image 12.png" },
  { name: "Hi Nanna", image: "./images/image 13.png" },
  { name: "Rangasthalam", image: "./images/image 14.png" },
  { name: "Sankarabharanam", image: "./images/image 15.png" },
  { name: "Manmadhudu", image: "./images/image 16.png" },
  { name: "Athadu", image: "./images/image 17.png" },
  { name: "Mathu Vadalara", image: "./images/image 18.png" },
  { name: "Kshanam", image: "./images/image 19.png" },
  { name: "Evaru", image: "./images/image 20.png" },
  { name: "Drushyam", image: "./images/image 21.png" },
  { name: "Vedam", image: "./images/image 22.png" },
  { name: "Aditya 369", image: "./images/image 23.png" },
  { name: "Gamyam", image: "./images/image 24.png" },
  { name: "Prasthanam", image: "./images/image 25.png" },
  { name: "Baahubali: The Beginning", image: "./images/image 26.png" },
  { name: "Geethanjali", image: "./images/image 27.png" },
  { name: "Tholi Prema", image: "./images/image 28.png" },
  { name: "Arjun Reddy", image: "./images/image 29.png" },
  { name: "Shiva", image: "./images/image 30.png" }
];
        let currentMovie;
        let score = 0;
        let timeLeft = 60;
        let timerInterval;
        let gameStarted = false;
        let recognition;

        const movieImage = document.getElementById('movieImage');
        const resultElement = document.getElementById('result');
        const startGameButton = document.getElementById('startGame');
        const timerElement = document.getElementById('timer');
        const scoreElement = document.getElementById('score');
        const userGuessElement = document.getElementById('userGuess');

        function loadNextMovie() {
            currentMovie = movies[Math.floor(Math.random() * movies.length)];
            movieImage.src = currentMovie.image;
            resultElement.textContent = '';
            userGuessElement.textContent = 'Your guess will appear here';
        }

        async function startGame() {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                gameStarted = true;
                score = 0;
                timeLeft = 60;
                updateScore();
                startGameButton.style.display = 'none';
                initializeSpeechRecognition();
                loadNextMovie();
                startTimer();
                recognition.start();
            } catch (err) {
                console.error('Error accessing microphone:', err);
                alert('Microphone access is required to play the game. Please allow microphone access and try again.');
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `Time: ${timeLeft}`;
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function updateScore() {
            scoreElement.textContent = `Score: ${score}`;
        }

        function endGame() {
            clearInterval(timerInterval);
            resultElement.textContent = `Game Over! Your final score is ${score}.`;
            startGameButton.style.display = 'inline';
            startGameButton.textContent = 'Play Again';
            gameStarted = false;
            recognition.stop();
        }

        function initializeSpeechRecognition() {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.continuous = true;
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const guess = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                console.log("Captured Speech: ", guess);
                userGuessElement.textContent = `Your guess: ${guess}`;
                const similarity = stringSimilarity(guess, currentMovie.name.toLowerCase());
                if (similarity >= 0.6) {
                    score++;
                    updateScore();
                    resultElement.textContent = 'Correct!';
                    setTimeout(loadNextMovie, 1000);
                } else {
                    resultElement.textContent = 'Incorrect. Try again!';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                resultElement.textContent = 'Error in speech recognition. Please try again.';
            };

            recognition.onend = () => {
                if (gameStarted) {
                    recognition.start();
                }
            };
        }

        function stringSimilarity(s1, s2) {
            const longer = s1.length > s2.length ? s1 : s2;
            const shorter = s1.length > s2.length ? s2 : s1;
            const longerLength = longer.length;
            if (longerLength === 0) {
                return 1.0;
            }
            return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
        }

        function editDistance(s1, s2) {
            s1 = s1.toLowerCase();
            s2 = s2.toLowerCase();
            const costs = new Array();
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i == 0) {
                        costs[j] = j;
                    } else {
                        if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) != s2.charAt(j - 1)) {
                                newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                            }
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                }
                if (i > 0) {
                    costs[s2.length] = lastValue;
                }
            }
            return costs[s2.length];
        }

        startGameButton.addEventListener('click', startGame);
    </script>
</body>
</html>
